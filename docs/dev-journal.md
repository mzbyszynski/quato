# Development Journal
_Oldest to newest_
## 2021-05-11: Getting Started
Not exactly starting now, but starting this document. Quato is an app I've wanted to build for a while. My hope is I can build it out enough so it works and I can use it myself. Stretch goal is to convince my partner to use it too. 

More on what it does later on when it does something, but for now I'm working on setting up the project and picking the stack. I'm torn between using what I am familiar with and enjoy, and trying out some new tools that I've been interested in but haven't had the chance to work with yet. So I'm doing a little bit of both. 

__Technologies that I know and love:__

* Typescript
* GraphQL
* React Native & Expo

     _I haven't used it in a few years but I remember loving it._
* Apollo Client
    
    _Been using this for a while but haven't had a chance to use the offline-first features, which I think will be a good fit for Quato._

__Some things that are new-to-me:__
* React Native Paper
* FaunaDB
    
    _Heard one of the founders on a podcast and what he said really resonated with me. Also Fauna has a direct GraphQL API!_
* Authenticating with Facebook and/or Google

    _Not wonderful but need to authorize something and authorizing on the backs of these folks with help with adoption by my second user._

### Setting Up the Project
I used the expo-cli to set up the project initially. I don't have a strong opinion about how to organize the project, beyond needing it to be organized, so I'll try to follow the layout that Expo generated.

I added _react-native-paper_ to use the UI widgets _ESLint_, _Prettier_, and _Husky_ to make sure the code is formatted consistent. I also added a README and this file.

I've also started replacing some of the generated expo code with some rough versions of a some of the basic screens I'm thinking of.

### What's Next?
1. Get the _SafeArea_ working properly.
1. Clean up my AddOpinion Screen so it is usable.
1. Add React Hook Form to wire up the AddOpinion form.
1. Add docker-compose to run FaunaDB container locally.
1. Set up basic GraphQL schema for FaunaDB.
1. Add Apollo client and create mutation to write data from AddOpinion form to fauna.
1. Work on the next screen.

## 2021-05-13: Learning Fauna
Started looking at FaunaDB. Decided to follow their [GraphQL tutorial](https://docs.fauna.com/fauna/current/tutorials/graphql/quick_start) using a local [docker image](https://docs.fauna.com/fauna/current/integrations/dev). Using their image was not straightforward but I found [this article](https://dev.to/englishcraig/how-to-set-up-faunadb-for-local-development-5ha7) that helped sort things out.

__Potential issues found with Fauna GraphQL:__
* Pagination is cool but results are [not currently sortable](https://forums.fauna.com/t/how-to-sort-graphql-query-results/372) without creating a customer query.

Also started working on authentication with Facebook. Trying the [expo package](https://docs.expo.io/versions/latest/sdk/facebook/).
Seems like I have to make a bunch of commitments to make this work.

## 2021-05-14: Facebook Auth
Putting GraphQL to the side to get authentication with Facebook working. Started doing some refactoring of the sample code generated by the expo-cli. 
1. Replacing declared _functions_ with arrow functions. I personally like arrow functions better. Coming from in-browser JavaScript development, I don't like the hoisting that happens with declared functions. I'm guessing this isn't an issue in React Native, but I'm ok with keeping my web React and native React consistent. I also like the idea of using a _function_ only when you explicitly need to reference _this_.

    I read a tweet by Dan Abrimov a while ago and he was suggesting this pattern of naming functional components as consts and then exporting the named const as the default export (rather than just exporting the anonymous arrow function). I remember it was something about better debugging and stack traces. Probably doesn't apply to React Native, but I'm just trying it out here to see how it feels anyway because it has been on my mind.
1. Defining types as part of the components that "own" them. I'm a big fan of encapsulated components as opposed to separating files by function. I think it just scales better in terms of repo organization. If a component encapsulates its own types and styles then it is easy to manage and you don't have to spread modifications across multiple files.

I was able to get the auth working with Facebook with help from the React Navigation documentation on [Authentication flows](https://reactnavigation.org/docs/auth-flow).

__TODO:__ Figure out how to manage secrets in React Native. I don't want to have to check in my Facebook app id or anything into github.

## 2021-05-17: Secrets
Took a slight detour to figure out how I should be storing the Facebook App ID using to authenticate users. Seems like this is safe to include in the compiled app but it is not 100% clear. For now I am going to use the [dotenv pattern](https://docs.expo.io/guides/environment-variables/#using-a-dotenv-file) described in the Expo docs so I don't have to checkin these at least. I will revisit this again if I ever get around to actually publishing this.

## 2021-05-21: db setup and crud
Was doing some reading and came across [nhost](https://nhost.io/), which is a hosted postgres/hasura GraphQL API, plus auth utilities and some other fun stuff. Going to stick with Fauna for now, but might switch over if I run into a wall. Also experiencing some FOMO about not using [Flutter](https://flutter.dev/), but I'm going to stick with Expo for now.

Took another slight detour to create a shell script that would initialize my local fauna db and create the graphQL schema. Had to do some Googling to get the awk command right. 

## 2021-06-11: 
Spent an absurd amount of time writing a shell script to initialize the database and export the GraphQL access token. Writing _sed_ and _awk_ scripts while refusing to just learn the syntax has always been a wonderful experience for me in the past. Finally have the startup working 95% working. 

Now I'm running into the limitations of FaunaDB's GraphQL API. I'm trying to search a list of names based on a search string and that seems to require a lot of work. You have to define a lambda function in FaunaDB (outside the graphQL Schema) and then integrate that with the schema using directives. I know this would be easy using a traditional relation database with a GraphQL server on top, so I might give up on Fauna and try out [nhost](https://nhost.io/). I'm trying to rapidly prototype my app at this point and taking a deep-dive into a new database that requires its own query language and has it's own proclivities seems like a distraction. FaunaDB has some exciting promises about scalability, but scaling is not a problem I have right now.
